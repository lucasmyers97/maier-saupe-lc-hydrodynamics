\documentclass[reqno]{article}
\usepackage{../format-doc}

\begin{document}
	\title{Maier-Saupe free energy in weak form}
	\author{Lucas Myers}
	\maketitle
	
	\section{Introduction}
	Here we will find a PDE describing the time evolution equation of the $Q$-tensor from thermodynamic effects, according to the Maier-Saupe free energy.
	Then we will discretize time according to a general finite difference scheme.
	After this, we will put the resulting space-dependent equations into weak form.
	The result will be non-linear, so we will have to use Newton's method to compute the solution to the finite difference scheme.
	
	\section{Maier-Saupe free energy and equations of motion}
	\subsection{Writing the free energy in terms of $Q_{ij}$}
	We begin by defining the tensor order parameter of the nematic system in terms of the probability distribution of the molecular orientation:
	\begin{equation} \label{eq:Q-def}
		Q_{ij} (\mathbf{x}) 
		= \int_{S^2} \left( \xi_i \xi_j - \tfrac13 \delta_{ij} \right)
		p(\mathbf{\xi} ; \mathbf{x}) d \mathbf{\xi}
	\end{equation}
	where $p(\mathbf{\xi} ; \mathbf{x})$ is the probability distribution of molecular orientation in local equilibrium at some temperature $T$ and position $\mathbf{x}$. 
	Note that this quantity is traceless and symmetric.
	Then the mean field free energy is given by:
	\begin{equation}
		F \left[ Q_{ij} \right] = H \left[ Q_{ij} \right] - T \Delta S
	\end{equation}
	where $H$ is the energy of the configuration, and $\Delta S$ is the entropy relative to the uniform distribution.
	We choose $H$ to be:
	\begin{equation}
		H\left[ Q_{ij} \right]
		= \int_{\Omega} \left\{ -\alpha Q_{ij} Q_{ji} + f_e 	\left( Q_{ij}, \partial_k Q_{ij} \right) \right\} d \mathbf{x}
	\end{equation}
	with $\alpha$ some interaction parameter and $f_e$ the elastic free energy density.
	The entropy is given by:
	\begin{equation} \label{eq:entropy-def}
		\Delta S 
		= -n k_B \int_{\Omega} \left(
		\int_{S^2} p(\mathbf{\xi} ; \mathbf{x}) 
		\log \left[ 4 \pi p( \mathbf{\xi} ; \mathbf{x} ) \right] d \mathbf{\xi} \right) d \mathbf{x}
	\end{equation}
	where n is the number density of molecules.
	Now, in general for a given $Q_{ij}$ there is no unique $p(\mathbf{\xi} ; \mathbf{x})$ given by \eqref{eq:Q-def}. 
	Hence, there is no unique $\Delta S$.
	To find the appropriate $\Delta S$ corresponding to some fixed $Q_{ij}$, we seek to maximize the entropy density for a fixed $Q_{ij}$ via the method of Lagrange multipliers. 
	This goes as follows:
	\begin{equation}
	\begin{split}
		\mathcal{L} [p]
		&= \Delta s [p] - \Lambda_{ij} Q_{ij} [p] \\
		&= \int_{S^2} p( \mathbf{\xi}) 
		\biggl(
		\log \left[ 4\pi p(\mathbf{\xi}) \right]
		- \Lambda_{ij} \left( \xi_i \xi_j - \tfrac13 \delta_{ij} \right)
		\biggr) d\mathbf{\xi}
	\end{split}
	\end{equation}
	Here we've taken the spatial dependence to be implicit, since each of these are local quantities, and we're minimizing them \textit{locally}.
	So, define a variation in $p$ given by:
	\begin{equation}
		p'(\mathbf{\xi}) 
		= p(\mathbf{\xi}) + \varepsilon \eta(\mathbf{\xi})
	\end{equation}
	Then we have that:
	\begin{equation}
	\begin{split}
		\frac{\delta \mathcal{L}}{\delta p}
		&= \left.\frac{d \mathcal{L}[p']}{d \varepsilon} \right|_{\varepsilon = 0} \\
		&= \left.\frac{d \mathcal{L} [p']}{d p'} \frac{d p'}{d \varepsilon} \right|_{\varepsilon = 0} \\
		&= \int_{S^2} \biggl(
		\log \left[ 4\pi p(\mathbf{\xi}) \right]
		- \Lambda_{ij} \left( \xi_i \xi_j - \tfrac13 \delta_{ij} \right)
		+ 1
		\biggr) \eta(\mathbf{\xi}) d \mathbf{\xi}
	\end{split}
	\end{equation}
	Since this is for an arbitrary variation $\eta$, we must have that
	\begin{equation}
	\log \left[ 4\pi p(\mathbf{\xi}) \right]
	- \Lambda_{ij} \left( \xi_i \xi_j - \tfrac13 \delta_{ij} \right)
	+ 1
	= 0
	\end{equation}
	Solving for $p(\mathbf{\xi})$ yields:
	\begin{equation}
		p(\mathbf{\xi}) 
		= \frac{1}{4 \pi}
		\exp \left[
		- \left(\tfrac13 \Lambda_{ij} \delta_{ij} + 1\right)
		\right]
		\exp\left[
		\Lambda_{ij} \xi_i \xi_j
		\right]
	\end{equation}
	However, $p(\mathbf{\xi})$ is a probability distribution, so we need to normalize it over the domain.
	When we do this, the constant factors out front cancel and we're just left with:
	\begin{equation} \label{eq:p-expr}
		p( \mathbf{\xi} )
		= \frac{\exp\left[ \Lambda_{ij} \xi_i \xi_j \right]}{Z\left[\Lambda\right]}
	\end{equation}
	\begin{equation}
		Z\left[\Lambda\right]
		= \int_{S^2} \exp[\Lambda_{ij} \xi_i \xi_j] d\mathbf{\xi}
	\end{equation}
	Now $p$ is uniquely defined in terms of the Lagrange multipliers $\Lambda_{ij}$.
	Plugging this back into the constraint equation \eqref{eq:Q-def} we get:
	\begin{equation}
	\begin{split}
		Q_{ij} 
		&= \frac{1}{Z[\Lambda]} \left( 
		\int_{S^2} \left( \xi_i \xi_j \exp[\Lambda_{kl} \xi_k \xi_l]
		- \tfrac13 \delta_{ij} \exp[\Lambda_{kl} \xi_k \xi_l] \right)
		d \mathbf{\xi} \right) \\
		&= \frac{1}{Z[\Lambda]} \left(
		\frac{\partial Z[\Lambda]}{\partial \Lambda_{ij}} - \tfrac13 \delta_{ij} Z[\Lambda]
		\right) \\
		&= \frac{\partial \log Z}{\partial \Lambda_{ij}} - \tfrac13 \delta_{ij}
	\end{split}
	\end{equation}
	This set of equations uniquely defines $\Lambda_{ij}$ in terms of $Q_{ij}$, although the equation is not algebraically solvable.
	We may also plug \eqref{eq:p-expr} into \eqref{eq:entropy-def} to get $\Delta S$ as a function of $\Lambda_{ij}$ (and therefore implicitly of $Q_{ij}$):
	\begin{equation}
	\begin{split}
		\Delta S
		&= -n k_B \int_{\Omega} \frac{1}{Z[\Lambda]} \left(
		\int_{S^2} \exp[\Lambda_{ij} \xi_i \xi_j]
		\left(\log(4\pi) + \log(1 / Z[\Lambda]) + \Lambda_{ij} \xi_i \xi_j\right) d \mathbf{\xi}
		\right) d\mathbf{x} \\
		&= -n k_B \int_{\Omega} \left(
		\log(4 \pi) - \log(Z[\Lambda])
		+ \Lambda_{ij} \frac{\partial \log Z[\Lambda]}{\partial \lambda_{ij}}
		\right) \\
		&= -n k_B \int_{\Omega} \left(
		\log(4 \pi) - \log(Z[\Lambda])
		+ \Lambda_{ij} \left( Q_{ij} + \tfrac13	 \delta_{ij} \right)
		\right)
	\end{split}
	\end{equation}
	Further, we may explicitly write out the elastic free energy as:
	\begin{equation}
		f_e (Q_{ij}, \partial_k Q_{ij})
		= L_1 \left(\partial_k Q_{ij}\right) \left(\partial_k Q_{ij}\right)
		+ L_2 \left(\partial_j Q_{ij}\right) \left(\partial_k Q_{ik}\right)
		+ L_3 Q_{kl} \left(\partial_k Q_{ij}\right) \left(\partial_l Q_{ij}\right)
	\end{equation}
	
	\subsection{Finding the equations of motion}
	Now, since $Q_{ij}$ is traceless and symmetric, we need to use a Lagrange multiplier scheme so that there is an extra piece in our free energy:
	\begin{equation}
		f_l = - \lambda Q_{ii} - \lambda_i \epsilon_{ijk} Q_{jk}
	\end{equation}
	To get a time evolution equation for $Q$, we just take the negative variation of the free energy density $f$ with respect to each of them:
	\begin{equation}
	\begin{split}
		\partial_t Q_{ij} 
		= - \frac{\partial f}{\partial Q_{ij}} 
		+ \partial_k \frac{\partial f}{\partial (\partial_k Q_{ij})}
	\end{split}
	\end{equation}
	Let's write out these terms explicitly.
	We start with the Maier-Saupe interaction term:
	\begin{equation}
	\begin{split}
		-\frac{\partial}{\partial Q_{ij}} \left(-\alpha Q_{kl} Q_{lk} \right)
		&= \alpha \delta_{ik} \delta_{jl} Q_{lk}
		+ \alpha \delta_{il} \delta_{jk} Q_{kl} \\
		&= 2 \alpha Q_{ij}
	\end{split}
	\end{equation}
	Now elastic energy:
	\begin{equation}
	\begin{split}
		-\frac{\partial}{\partial Q_{ij}} \left( L_3 Q_{kl} (\partial_k Q_{nm}) (\partial_l Q_{nm}) \right)
		&= - L_3 \delta_{ik} \delta_{jl} (\partial_k Q_{nm}) (\partial_l Q_{nm}) \\
		&= -L_3 (\partial_i Q_{nm}) (\partial_j Q_{nm})
	\end{split}
	\end{equation}
	And the Lagrange multiplier terms:
	\begin{equation}
	\begin{split}
		-\frac{\partial}{\partial Q_{ij}} \left(
		- \lambda Q_{kk} - \lambda_k \epsilon_{klm} Q_{lm}
		\right)
		&= \lambda \delta_{ik} \delta_{jk}
		+ \lambda_k \epsilon_{klm} \delta_{il} \delta_{jm} \\
		&= \lambda \delta_{ij} + \lambda_k \epsilon_{kij}
	\end{split}
	\end{equation}
	Now for the other elastic energy terms:
	\begin{equation}
	\begin{split}
		\partial_k \frac{\partial f}{\partial (\partial_k Q_{ij})} L_1 (\partial_l Q_{nm})(\partial_l Q_{nm})
		&= L_1 \partial_k \left( \delta_{kl} \delta_{in} \delta_{jm} \partial_l Q_{nm}
		+ \partial_l Q_{nm} \delta_{kl} \delta_{ik} \delta_{jm} \right) \\
		&= 2 L_1 \partial_k \partial_k Q_{ij}
	\end{split}
	\end{equation}
	And the $L_2$ term:
	\begin{equation}
	\begin{split}
		\partial_k \frac{\partial f}{\partial (\partial_k Q_{ij})} L_2 (\partial_m Q_{lm}) (\partial_n Q_{ln})
		&= L_2 \partial_k \left( \delta_{km} \delta_{il} \delta_{jm} (\partial_n Q_{ln})
		+ (\partial_m Q_{lm}) \delta_{kn} \delta_{il} \delta_{jn} \right) \\
		&= L_2 \partial_k \left( \delta_{kj} (\partial_n Q_{in}) + \delta_{kj} (\partial_m Q_{im}) \right) \\
		&= 2 L_2 \partial_j (\partial_m Q_{im})
	\end{split}
	\end{equation}
	And finally the $L_3$ term:
	\begin{equation}
	\begin{split}
		\partial_k \frac{\partial f}{\partial (\partial_k Q_{ij})} L_3 Q_{np} (\partial_n Q_{lm}) (\partial_p Q_{lm}) 
		&= L_3 \partial_k Q_{np} \left( \delta_{kn} \delta_{il} \delta_{jm} (\partial_p Q_{lm})
		+ (\partial_n Q_{lm}) \delta_{kp} \delta_{il} \delta_{jm} \right) \\
		&= L_3 \partial_k \left( Q_{kp} (\partial_p Q_{ij}) + Q_{nk} (\partial_n Q_{ij}) \right) \\
		&= 2 L_3 \partial_k \bigl( Q_{kn} (\partial_n Q_{ij}) \bigr)
	\end{split}
	\end{equation}
	Finally, we consider the entropy term:
	\begin{equation}
	\begin{split}
		- \frac{\partial}{\partial Q_{ij}} (-T \Delta s)
		&=
		- \frac{\partial}{\partial Q_{ij}} \left[ -n k_B T \left(
		\log(4 \pi) - \log( Z[\Lambda] ) + \Lambda_{kl} (Q_{kl} + \tfrac13 \delta_{kl} \right) \right] \\
		&= n k_B T \left( - \frac{\partial \log Z}{\partial \Lambda_{kl}} \frac{\partial \Lambda_{kl}}{\partial Q_{ij}}
		+ \frac{\partial \Lambda_{kl}}{\partial Q_{ij}} \left( Q_{kl} + \tfrac13 \delta_{kl}\right)
		+ \Lambda_{kl} \delta_{ik} \delta_{jl} \right) \\
		&= n k_B T \left( -\left( Q_{kl} + \tfrac13 \delta_{kl} \right) \frac{\partial \Lambda_{kl}}{\partial Q_{ij}} 
		+ \frac{\partial \Lambda_{kl}}{\partial Q_{ij}} \left( Q_{kl} + \tfrac13 \delta_{kl}\right)
		+ \Lambda_{ij} \right) \\
		&= n k_B T \Lambda_{ij}
	\end{split}
	\end{equation}
	Finally, we need to write down the Lagrange multipliers in terms of $Q$ and its spatial derivatives.
	To do this, note that $Q_{ij}$ is traceless and symmetric so that $\partial_t Q_{ij}$ is also traceless and symmetric.
	Hence, to find $\lambda$ we just take negative $\tfrac13$ the trace of the source term.
	This gives:
	\begin{equation}
	\begin{split}
		\lambda
		&= -\tfrac13 \left(
		- L_3 (\partial_i Q_{nm}) (\partial_i Q_{nm})
		+ 2 L_2 \partial_i ( \partial_m Q_{im} )
		\right) \\
		&= \tfrac13 \left( 
		L_3 (\partial_i Q_{nm}) (\partial_i Q_{nm})
		- 2 L_2 \partial_i ( \partial_m Q_{im} )
		\right)
	\end{split}
	\end{equation}
	where the rest of the terms are traceless.
	Now to find $\lambda_k$, we know that the anti-symmetric piece of any matrix can be given by:
	\begin{equation}
		\tfrac12 \left( A_{ij} - A_{ji} \right)
	\end{equation}
	Further, the Lagrange multiplier term needs to cancel out the anti-symmetric piece:
	\begin{equation}
		\lambda_k \epsilon_{kij} = -\tfrac12 \left( A_{ij} - A_{ji} \right)
	\end{equation}
	To solve for $\lambda_k$ explicitly, we may calculate:
	\begin{equation}
	\begin{split}
		-\tfrac12 \epsilon_{lij} \left( A_{ij} - A_{ji} \right)
		&= \lambda_k \epsilon_{kij} \epsilon_{lij} \\
		&= \lambda_k \left( \delta_{kl} \delta_{ii} - \delta_{ki} \delta_{il} \right) \\
		&= 2 \lambda_l
	\end{split}
	\end{equation}
	Hence:
	\begin{equation}
	\begin{split}
		\lambda_l 
		&= -\tfrac12 L_2 \epsilon_{lij} \left( \partial_j (\partial_m Q_{im}) - \partial_i (\partial_m Q_{jm}) \right) \\
		&= \tfrac12 L_2 \epsilon_{lij} \left( \partial_i (\partial_m Q_{jm})
		- \partial_j (\partial_m Q_{im}) \right)
	\end{split}
	\end{equation}
	since the $L_2$ term is the only one that's anti-symmetric.
	The source term corresponding to this Lagrange multiplier piece is then given by:
	\begin{equation}
	\begin{split}
		\tfrac12 L_2 \bigl( (\partial_k \partial_n Q_{mn}) - (\partial_m \partial_n Q_{kn} ) \bigr) \epsilon_{lkm} \epsilon_{lij}
		&= \tfrac12 L_2 \bigl( (\partial_k \partial_n Q_{mn}) - (\partial_m \partial_n Q_{kn} ) \bigr)
		\left( \delta_{ki} \delta_{mj} - \delta_{kj} \delta_{mi} \right) \\
		&= \tfrac12 L_2 \bigl( (\partial_i \partial_n Q_{jn}) - (\partial_j \partial_n Q_{in} ) \bigr)
		- \tfrac12 L_2 \bigl( (\partial_j \partial_n Q_{in}) - (\partial_i \partial_n Q_{jn} ) \bigr) \\
		&= L_2 \bigl( (\partial_i \partial_n Q_{jn}) - (\partial_j \partial_n Q_{in} ) \bigr)
	\end{split}
	\end{equation}
	Hence, the total equation of motion is:
	\begin{equation}
	\begin{split}
		\partial_t Q_{ij}
		&=
		\begin{multlined}[t]
		2 \alpha Q_{ij}
		- L_3 (\partial_i Q_{nm}) (\partial_j Q_{nm}) 
		+ \tfrac13 \left( L_3 (\partial_k Q_{nm})(\partial_k Q_{nm}) 
		- 2 L_2 (\partial_k \partial_m Q_{km}) \right) \delta_{ij} \\
		+ L_2 \bigl( (\partial_i \partial_n Q_{jn}) - (\partial_j \partial_n Q_{in} ) \bigr)
		+ n k_B T \Lambda_{ij} \\
		+ 2 L_1 \partial_k \partial_k Q_{ij} 
		+ 2 L_2 (\partial_j \partial_m Q_{im})
		+ 2 L_3 \partial_k \bigl( Q_{kn} (\partial_n Q_{ij}) \bigr)
		\end{multlined} \\
		&=
		\begin{multlined}[t]
		2 \alpha Q_{ij}
		- L_3 (\partial_i Q_{nm}) (\partial_j Q_{nm})
		+ n k_B T \Lambda_{ij} \\
		+ 2 L_1 \partial_k \partial_k Q_{ij} 
		+ L_2 \left( (\partial_j \partial_m Q_{im}) + (\partial_i \partial_m Q_{jm}) \right)
		+ 2 L_3 \partial_k \bigl( Q_{kn} (\partial_n Q_{ij}) \bigr) \\
		+ \tfrac13 \left( L_3 (\partial_k Q_{nm})(\partial_k Q_{nm}) 
		- 2 L_2 (\partial_k \partial_m Q_{km}) \right) \delta_{ij}
		\end{multlined} \\
		&= F_{ij} \left(Q_{ij} ; \partial_k Q_{ij} ; \partial_l \partial_k Q_{ij}\right)
	\end{split}
	\end{equation}
	One can see that $F_{ij}$ is both symmetric and traceless by virtue of $Q_{ij}$ being traceless and symmetric.
	
	\subsection{Reducing degrees of freedom}
	Since $Q_{ij}$ is traceless and symmetric, we only have five independent degrees of freedom.
	We label as follows:
	\begin{equation}
	Q_{ij}
	= \begin{bmatrix}
	Q_1 & Q_2 & Q_3 \\
	Q_2 & Q_4 & Q_5 \\
	Q_3 & Q_5 & -(Q_1 + Q_4)
	\end{bmatrix}
	\end{equation}
	We can define similarly for $F_{ij}$.
	In this case, we just get a five-component vector equation:
	\begin{equation}
		\partial_t Q_i = F_i \left( Q_i ; \partial_j Q_i ; \partial_k \partial_j Q_i \right)
	\end{equation}
	where, we may write $F_i$ as a function of the vector components $Q_i$ (and spatial derivatives thereof) by just explicitly carrying out the sums over the tensor indices.
	This observation reduces the number of equations from 9 down to 5.
	
	\section{Numerical scheme}
	\subsection{Time discretization}
	To numerically solve this equation, we use Rothe's method to discretize the time dependence before the spatial dependence.
	To this end, we introduce the following finite difference scheme.
	For $n$ the number of the current time step, call:
	\begin{align}
		k &= t_n - t_{n - 1} \\
		\partial_t Q_i &\to \frac{Q^n_i - Q^{n - 1}_i}{k} \\
		F_i &\to \left[ \theta F_i^n + (1 - \theta) F_i^{n - 1} \right]
	\end{align}
	where $F^n_i$ is just $F_i$ with $Q_i$ evaluated at timestep $n$.
	Here $\theta = 0$ corresponds to an explicit Euler method, while $\theta = 1$ corresponds to an implicit Euler method.
	Also, $\theta = 1/2$ corresponds to a Crank-Nicolson method -- we leave it undefined so that we may play with it later.
	The time-discretized equation is thus:
	\begin{equation}
	\begin{split}
		G_i \left(Q^n_i ; \partial_k Q^n_i ; \partial_l \partial_k Q^n_i\right)
		&= k \left[ \theta F^n_i + (1 - \theta) F^{n - 1}_i \right]
		- Q^n_i + Q^{n - 1}_i \\
		&= 0
	\end{split}
	\end{equation}
	
	\subsection{Space discretization}
	To turn this into a finite element problem, we introduce a scalar residual function:
	\begin{equation}
		R \left(Q^n_i ; \partial_k Q^n_i ; \partial_l \partial_k Q^n_i\right) (\phi_i)
		= \int_\Omega G_i \phi_i
		= 0
	\end{equation}
	where $\phi_i$ is a vector of test functions.
	Now, we would like to only sum over the 5 free components to keep from making redundant calculations.
	However, in the explicit definition of $F_i$ there are two floating indices which are, on some terms, located on differential operators.
	Hence, we consider a tensor test function which is defined in the same way as $Q_{ij}$:
	\begin{equation}
		\phi_{ij}
		= \begin{bmatrix}
		\phi_1 & \phi_2 & \phi_3 \\
		\phi_2 & \phi_4 & \phi_5 \\
		\phi_3 & \phi_5 & -(\phi_1 + \phi_4)
		\end{bmatrix}
	\end{equation}
	We can write the expression for $F^n_i$ out explicitly as follows:
	\begin{equation}
	\begin{split}
		\int_\Omega F^n_i \phi_i
		&=
		\int_\Omega F^n_{ij} \phi_{ij} \\
		&= 
		\begin{multlined}[t]
			2 \alpha \int_\Omega Q^n_{ij} \phi_{ij}
			- L_3 \int_\Omega (\partial_i Q^n_{nm})(\partial_j Q^n_{nm}) \phi_{ij}
			+ n k_B T \int_\Omega \Lambda_{ij} \phi_{ij} \\
			+ 2 L_1 \int_{\partial \Omega} n_k (\partial_k Q^n_{ij}) \phi_{ij}
			- 2 L_1 \int_{\Omega} (\partial_k Q^n_{ij})(\partial_k \phi_{ij}) 
			+ L_2 \int_{\partial \Omega} n_m (\partial_j Q^n_{im}) \phi_{ij} \\
			- L_2 \int_\Omega (\partial_j Q^n_{im}) (\partial_m \phi_{ij}) 
			+ L_2 \int_{\partial \Omega} n_m (\partial_i Q^n_{jm}) \phi_{ij}
			- L_2 \int_\Omega (\partial_i Q^n_{jm}) (\partial_m \phi_{ij}) \\
			+ 2 L_3 \int_{\partial \Omega} n_k Q^n_{kn} (\partial_n Q^n_{ij}) \phi_{ij} 
			- 2 L_3 \int_\Omega Q^n_{kn} (\partial_n Q^n_{ij}) (\partial_k \phi_{ij})
			+ \tfrac13 L_3 \int_\Omega (\partial_k Q^n_{nm}) (\partial_k Q^n_{nm}) \phi_{ii} \\
			- \tfrac23 L_2 \int_{\partial \Omega} n_k (\partial_m Q^n_{km}) \phi_{ii}
			+ \tfrac23 L_2 \int_\Omega (\partial_m Q^n_{km}) (\partial_k \phi_{ii})
		\end{multlined}
	\end{split}
	\end{equation}
	where we understand the sum over $(i, j)$ to be only over those components which are distinct in the test function (i.e. (1, 1), (1, 2), (1, 3), (2, 2), (2, 3)), and where $n_i$ is the vector normal to the boundary.
	Note that the other sums (e.g. over $m$) range over all three elements because that is how they appear in the definition of $F_i$.
	
	At this point, we choose Dirichlet boundary conditions so that $\phi_i$ comes from the tangent space and thus takes value zero on the boundary.
	This lets us disregard all of the boundary terms.
	Further, we use the inner product notation $\left< \cdot, \cdot \right>$ to denote the integral over the domain.
	This reduces the expression to:
	\begin{equation}
		\left< F^n_i, \phi_i \right>
		=
		\begin{multlined}[t]
			2 \alpha \left< Q^n_i, \phi_i \right>
			+ n k_B T \left< \Lambda_i, \phi_i \right>
			- 2 L_1 \left< \partial_k Q^n_i, \partial_k \phi_i \right> \\
			- L_2 \biggl[
			\left< \partial_j Q^n_{im} + \partial_i Q^n_{jm}, \partial_m \phi_{ij} \right>
			- \tfrac23 \left< \partial_m Q^n_{km}, \partial_k \phi_{ij} \delta_{ij} \right>
			\biggr] \\
			- L_3 \biggl[
			\left< (\partial_i Q^n_{nm}) (\partial_j Q^n_{nm}), \phi_{ij} \right>
			+ 2 \left< Q^n_{kn} (\partial_n Q^n_i), \partial_k \phi_i \right> \\
			- \tfrac13 \left< (\partial_k Q^n_{nm})(\partial_k Q^n_{nm}), \phi_{ij} \delta_{ij} \right>
			\biggr]
		\end{multlined}
	\end{equation}
	With this explicit expression in mind, the residual function is given by:
	\begin{equation}
		R(Q^n) (\phi) =
		k \biggl[
		\theta \left< F^n_i, \phi_i \right> 
		+ (1 - \theta) \left< F^{n - 1}_i, \phi_i \right>
		\biggr]
		- \left< Q^n_i, \phi_i \right>
		+ \left< Q^{n - 1}_i, \phi_i \right>
	\end{equation}
	For each time step, we will need to iteratively solve for $Q^n$ as a zero of this expression using Newton's method.
	Using subscripts to denote the number of the iteration in Newton's method, the method reads:
	\begin{align}
		R'(Q^n_{k - 1}, \delta Q^n_{k - 1}) (\phi)
		&= - R(Q^n_{k - 1}) (\phi) \\
		Q^n_k
		&= Q^n_{k - 1} + \delta Q^n_{k - 1}
	\end{align}
	To be clear about what objects we're dealing with here, for a fixed test function $\phi$, $R(Q^n_{k - 1})$ is a scalar, and $R'(Q^n_{k - 1})$ is a linear operator which acts on $\delta Q^n_{k - 1}$ to produce a scalar.
	In this case, we can create a linear system by solving this equation simultaneously for some number $N$ of basis functions.
	Writing $\delta Q^n_{k - 1}$ as a linear combination of these basis elements, we now have a linear equation in those elements which we may solve for the coefficients.
	Hence, we can find $Q^n$ and thus step forward in time.
	
	\subsection{Numerically inverting $Q_{ij} (\Lambda)$}
	Here we have the following explicit expression for $Q_{ij}$ in terms of $\Lambda_{ij}$:
	\begin{equation}
		Q_{ij} (\Lambda)
		= \frac{\int_{S^2} \xi_i \xi_j \exp\left[\Lambda_{kl} \xi_k \xi_l \right] d \xi}
		{\int_{S^2} \exp\left[\Lambda_{kl} \xi_k' \xi_l'\right] d\xi'}
		- \tfrac13 \delta_{ij}
	\end{equation}
	For this we choose a set of interpolation points for allowed values of the distinct components of $Q$, and then use Newton's method to find the corresponding values for $\Lambda$.
	Note that, during these calculations, we use Lebedev quadrature to do the integrations over the sphere.
	Finally, we may interpolate between chosen values of $Q$ to find the values of $\Lambda$ for a given $Q$.
	
	To actually implement Newton's method, we do as follows.
	For any fixed $Q_{ij}$ define a vector residual $R_m$ such that:
	\begin{equation}
		R_m (\Lambda)
		= \frac{\int_{S^2} \xi_{i(m)} \xi_{j(m)} \exp\left[\Lambda_{kl} \xi_k \xi_l \right] d \xi}
		{\int_{S^2} \exp\left[\Lambda_{kl} \xi_k' \xi_l'\right] d\xi'}
		- \tfrac13 \delta_{i(m) j(m)}
		- Q_{i(m) j(m)}
	\end{equation}
	where $m$ refers to the index of the distinct degrees of freedom of $Q$, and $(i(m), j(m))$ denotes the location in the matrix.
	We see values of $\Lambda_m$ which will be a zero of this quantity.
	Hence, we must find the Jacobian, which is just:
	\begin{equation}
		R'(\Lambda) = \frac{\partial R_m}{\partial \Lambda_n}
	\end{equation}
	This will be a $5\times 5$ matrix which we may compute as follows:
	\begin{equation}
		R'_{mn} 
		= \frac{\int_{S^2} \xi_{i(m)} \xi_{i(n)} \xi_{j(m)} \xi_{j(n)} \exp\left[\Lambda_{kl} \xi_k \xi_l\right] d\xi}{\int_{S^2} \xi_{i(n)} \xi_{j(n)} \exp\left[\Lambda_{kl} \xi_k' \xi_l'\right] d\xi}
		- \tfrac13 \delta_{i(m) j(m)}
		- Q_m
	\end{equation}
	Then we must solve:
	\begin{align}
		R'_{ij} (\Lambda^n) \delta \Lambda^n_j &= -R_m (\Lambda^n) \\
		\Lambda^{n + 1}_{i} &= \Lambda^n_{i} + \delta \Lambda^n_i
	\end{align}
	iteratively until $\left| R_m (\Lambda^n) \right| < \epsilon$ for some small error $\epsilon$.
	
	\section{A first problem to solve numerically}
	In order to get our feet wet programming with numerical libraries, we begin by solving the problem of numerically inverting $Q_{ij} (\Lambda)$.
	
	
	
\end{document}